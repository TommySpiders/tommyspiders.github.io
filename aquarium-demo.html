<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Aquarium Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />

  <style>
    @media screen and (orientation: portrait) {
      body::before {
        content: "Please rotate your device";
        position: fixed;
        inset: 0;
        background: #000;
        color: #fff;
        font-size: 26px;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 99999;
      }
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      overflow: hidden;
      background: #000;
      font-family: system-ui, sans-serif;
      touch-action: none;
      color: #fff;
    }

    #camera {
      position: fixed;
      inset: 0;
      overflow: hidden;
      touch-action: none;
    }

    #world {
      position: absolute;
      inset: 0;
      width: 300vw;
      height: 100vh;
      background-image: url("bg-underwater.PNG");
      background-size: 300vw 100vh;
      background-repeat: no-repeat;
      transform-origin: top left;
    }

    #fishLayer {
      position: absolute;
      inset: 0;
      width: 300vw;
      height: 100vh;
      pointer-events: none;
    }

    /* Realistic guppy sprite */
    .fish {
      position: absolute;
      width: 140px;
      height: 80px;
      background-image: url("guppy1.PNG");
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      transform-origin: center;
      pointer-events: auto;
      filter: drop-shadow(0 6px 8px rgba(0,0,0,0.5));
    }

    #feedBtn, #cleanBtn, #buyBtn, #shopBtn {
      position: fixed;
      width: 45px;
      height: 45px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fff, #aee2ff, #58c1ff);
      border: 2px solid rgba(255,255,255,0.6);
      box-shadow: 0 0 10px rgba(0,140,255,0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 5;
      font-size: 20px;
    }

    #feedBtn  { left: 10px; top: 22%; }
    #cleanBtn { left: 10px; top: 42%; }
    #buyBtn   { right: 10px; top: 22%; }
    #shopBtn  { right: 10px; top: 42%; }

    #coinBubble {
      position: fixed;
      top: 15px;
      right: 20px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: radial-gradient(circle, #fff4a6, #e1a800);
      border: 2px solid rgba(255,255,255,0.6);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: #603800;
      font-weight: bold;
      z-index: 10;
    }
  </style>
</head>
<body>

<div id="camera">
  <div id="world">
    <div id="fishLayer"></div>
  </div>
</div>

<!-- UI -->
<div id="feedBtn">üç§</div>
<div id="cleanBtn">üßΩ</div>
<div id="buyBtn">üê†</div>
<div id="shopBtn">üõí</div>

<div id="coinBubble">ü™ô<span id="coinCount">80</span></div>

<script>
/* ------------------------------------------
   BASIC STATE
------------------------------------------*/
let coins = 80;
const fishList = [];
let nextFishId = 1;

/* WORLD */
const cameraEl = document.getElementById("camera");
const worldEl = document.getElementById("world");
const fishLayer = document.getElementById("fishLayer");

function getWorldWidth() { return window.innerWidth * 3; }
function getWorldHeight() { return window.innerHeight; }

/* Camera (only horizontal movement) */
let camX = 0, camScale = 1;
function applyCamera() {
  worldEl.style.transform = `translateX(${camX}px) scale(${camScale})`;
}
function centerCamera() {
  camX = window.innerWidth / 2 - getWorldWidth() / 2;
  applyCamera();
}
centerCamera();

/* ------------------------------------------
   CREATE FISH (REALISTIC)
------------------------------------------*/
function createGuppy() {
  if (coins < 20) return;
  coins -= 20;
  document.getElementById("coinCount").textContent = coins;

  const worldW = getWorldWidth();
  const worldH = getWorldHeight();

  const fish = {
    id: nextFishId++,
    x: Math.random() * (worldW - 300) + 150,
    y: Math.random() * (worldH * 0.6) + worldH * 0.2,

    vx: 0,
    vy: 0,
    speed: Math.random() * 40 + 60,     // moderate natural speed
    direction: Math.random() < 0.5 ? 1 : -1,

    wigglePhase: Math.random() * Math.PI * 2,
    wiggleSpeed: 6,                      // medium wiggle
    wiggleAmount: 6,                     // degrees

    targetY: null,
    driftTimer: 0,

    burstTimer: Math.random() * 4 + 3,   // dart burst cooldown

    awarenessRadius: 300,                // high awareness
    avoidRadius: 80,                     // collision avoidance
    cohesionFactor: 0.15,                // loose schooling
    alignmentFactor: 0.1,
    separationFactor: 0.4,

    el: null
  };

  const el = document.createElement("div");
  el.className = "fish";
  fish.el = el;
  fishLayer.appendChild(el);
  fishList.push(fish);
}

/* ------------------------------------------
   FISH MOVEMENT ‚Äî REALISTIC SCHOOLING
------------------------------------------*/
function updateFish(dt) {
  const worldW = getWorldWidth();
  const worldH = getWorldHeight();

  for (let f of fishList) {

    /* 1. FIND NEIGHBOR FISH */
    let neighborCount = 0;
    let avgX = 0, avgY = 0;
    let avgVX = 0;

    let sepX = 0, sepY = 0;

    for (let other of fishList) {
      if (other === f) continue;

      const dx = other.x - f.x;
      const dy = other.y - f.y;
      const dist = Math.hypot(dx, dy);

      if (dist < f.awarenessRadius) {
        neighborCount++;
        avgX += other.x;
        avgY += other.y;
        avgVX += other.direction;

        if (dist < f.avoidRadius) {
          sepX -= dx / dist;
          sepY -= dy / dist;
        }
      }
    }

    /* 2. APPLY SCHOOLING FORCES */
    let steerX = 0;
    let steerY = 0;

    if (neighborCount > 0) {
      avgX /= neighborCount;
      avgY /= neighborCount;
      avgVX /= neighborCount;

      // Cohesion
      steerX += (avgX - f.x) * f.cohesionFactor;
      steerY += (avgY - f.y) * f.cohesionFactor;

      // Alignment (horizontal only)
      steerX += avgVX * f.alignmentFactor;

      // Separation
      steerX += sepX * f.separationFactor;
      steerY += sepY * f.separationFactor;
    }

    /* 3. SOFT BUOYANCY DRIFT */
    f.driftTimer -= dt;
    if (f.driftTimer <= 0) {
      f.targetY = f.y + (Math.random() - 0.5) * 80;
      f.targetY = Math.max(worldH * 0.15, Math.min(worldH * 0.85, f.targetY));
      f.driftTimer = Math.random() * 2 + 1;
    }

    if (f.targetY != null) {
      steerY += (f.targetY - f.y) * 0.02;
    }

    /* 4. DART BURSTS */
    f.burstTimer -= dt;
    if (f.burstTimer <= 0) {
      f.speed += Math.random() * 40 + 40;
      f.burstTimer = Math.random() * 4 + 3;
    }

    /* 5. UPDATE VELOCITY */
    f.vx = f.direction * f.speed * dt + steerX;
    f.vy = steerY * dt;

    f.x += f.vx;
    f.y += f.vy;

    /* 6. TURN AROUND EDGES */
    if (f.x < 150) { f.x = 150; f.direction = 1; }
    if (f.x > worldW - 150) { f.x = worldW - 150; f.direction = -1; }

    if (f.y < 60) f.y = 60;
    if (f.y > worldH - 90) f.y = worldH - 90;

    /* 7. TAIL WIGGLE (REALISTIC) */
    f.wigglePhase += f.wiggleSpeed * dt;
    const tilt = Math.sin(f.wigglePhase) * f.wiggleAmount;

    /* 8. APPLY RENDER TRANSFORM */
    const face = f.direction === 1 ? 1 : -1;
    f.el.style.left = `${f.x}px`;
    f.el.style.top = `${f.y}px`;
    f.el.style.transform =
      `scaleX(${face}) rotate(${tilt}deg)`;
  }
}

/* ------------------------------------------
   MAIN LOOP
------------------------------------------*/
let lastTime = null;
function tick(ts) {
  if (!lastTime) lastTime = ts;
  const dt = (ts - lastTime) / 1000;
  lastTime = ts;

  updateFish(dt);
  requestAnimationFrame(tick);
}

/* ------------------------------------------
   INIT
------------------------------------------*/
function startGame() {
  createGuppy();
  createGuppy();
  createGuppy();
  requestAnimationFrame(tick);
}

startGame();

/* UI */
document.getElementById("buyBtn").onclick = createGuppy;
document.getElementById("feedBtn").onclick = () => {};
document.getElementById("cleanBtn").onclick = () => {};
document.getElementById("shopBtn").onclick = () => {};
</script>
</body>
</html>
